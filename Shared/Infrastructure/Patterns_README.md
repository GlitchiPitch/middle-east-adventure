# –ù–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–≠—Ç–∞–ø 4)

## üéØ Unit of Work –ø–∞—Ç—Ç–µ—Ä–Ω

### –û–ø–∏—Å–∞–Ω–∏–µ

Unit of Work –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

* `beginTransaction()` - –Ω–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
* `commit()` - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
* `rollback()` - –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
* `registerDirty(entity)` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å
* `registerNew(entity)` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å—É—â–Ω–æ—Å—Ç—å
* `registerDeleted(entity)` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```lua
-- –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
unitOfWork:beginTransaction()

-- –í—ã–ø–æ–ª–Ω—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏
inventoryRepository:addItem(player, "sword", {amount = 1})
equipmentRepository:equipItem(player, "sword", "main_hand")

-- –§–∏–∫—Å–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
unitOfWork:commit()
```

## üéØ –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞

### –û–ø–∏—Å–∞–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —Å–æ–±—ã—Ç–∏–π.

### –°–æ–±—ã—Ç–∏—è:

* `EntityUpdated` - —Å—É—â–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞
* `EntityDeleted` - —Å—É—â–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞
* `EntityCreated` - —Å—É—â–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è:

```lua
{
    entityType = "Inventory",     -- —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏
    entityId = "123456",          -- ID —Å—É—â–Ω–æ—Å—Ç–∏
    changes = {                   -- –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        inventory = true,
        itemName = "sword",
        action = "added"
    }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:

–ö–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏:

* –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
* –ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏ ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
* –ö–∞—Å–∫–∞–¥–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:

* ‚úÖ –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞
* ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

* ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
* ‚úÖ –ö–∞—Å–∫–∞–¥–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* ‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Ä—É—á–Ω–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–µ—à–µ–º

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:

* ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
* ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
* ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
Shared/Infrastructure/Services/
‚îú‚îÄ‚îÄ UnitOfWork.luau          # Unit of Work –ø–∞—Ç—Ç–µ—Ä–Ω
‚îú‚îÄ‚îÄ EventEmitter.luau        # –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π
‚îî‚îÄ‚îÄ Cache.luau               # –ö–µ—à —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

Server/Application/UseCases/
‚îî‚îÄ‚îÄ EquipItemExample.luau    # –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

[–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏]
‚îú‚îÄ‚îÄ Shared/Infrastructure/Repositories/InventoryRepository.luau
‚îú‚îÄ‚îÄ Shared/Infrastructure/Repositories/EquipmentRepository.luau
‚îú‚îÄ‚îÄ Server/Infrastructure/InventoryRepository.luau
‚îî‚îÄ‚îÄ ...
```
